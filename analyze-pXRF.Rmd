---
title: "pXRF analysis"
author: "Uine Kailam√§ki"
date: "11/27/2020"
output: word_document
fig_width: 12 
fig_height: 10 
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)

```

## Title

Text

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Code for citating packages: citation("dplyr")
library(dplyr); library(GGally); library(corrplot); library(tidyr); library(openxlsx)

# Read data
n2 <- read.table("data/z2-pXRF.txt", header = TRUE, dec = ".", stringsAsFactors = TRUE)
n2 <- read.xlsx("data/n2-pXRF.xlsx", sep=";")

# For correlation and PCA "Samples" must be rownames instead of factors
rownames(n2) <- n2$Sample
n2 <- n2 %>% select(-Sample)

# Visualize correlations
cor(n2) %>% corrplot (type = "lower", tl.cex = 0.7, tl.pos="d", cl.pos="r")
ggpairs(n2)
ggplot(n2)

# Calculate the total within sum of squares to find the optimal number of clusters
k_max <- 8
twcss <- sapply(1:k_max, function(k){kmeans(n2, k)$tot.withinss})
qplot(x = 1:k_max, y = twcss, geom = 'line')

# Clustering
km <-kmeans(n2, centers = 2)
cluster2 <- as.factor(km$cluster)
ggpairs(n2, mapping = aes(col = cluster2))

# PCA
pca_n2 <- prcomp(n2)
summary(pca_n2)

biplot(pca_n2, choices = 1:2, cex = c(0.5, 0.7), col = c("grey80", "deeppink2"))

# HCA



```


