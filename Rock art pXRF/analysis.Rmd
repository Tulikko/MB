---
title: "pXRF analysis"
author: "Uine Kailam√§ki"
date: "04/01/2021"
output: word_document

---

```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width = "100%"}
# Necessary libraries
# Code for citating packages: citation("dplyr")
library(dplyr); 
library(GGally); 
library(corrplot); 
library(tidyr); 
library(openxlsx); 
library(cluster); 
library(ggplot2); 
library(ggfortify); 
library(pca3d)

# Read data
n1 <- read.xlsx("All_PCA2.xlsx", sep=";")

# For correlation and PCA "Samples" must be rownames instead of factors
rownames(n1) <- n1$Sample
n1 <- n1 %>% select(-Sample)
n2 <- n1 %>% select(-Type)

# n2$Type <- factor(n2$Type)
colnames(n1)
glimpse(n1)

# Scale data, n1 ignoring the first column "Type"
n2 <- scale(n2)

## n1_scaled <- scale(n1[2:14])
## n1_temp <- as.data.frame(n1_scaled)
## n1 <- mutate(n1_temp, "Type" = n1$Type)
## n1 <- n1_temp

# Visualize correlations
cor(n2) %>% corrplot (type = "lower", tl.cex = 0.7, tl.pos="d", cl.pos="r")
ggpairs(n2)
ggplot(n2)

# Calculate the total within sum of squares to find the optimal number of clusters
k_max <- 6
twcss <- sapply(1:k_max, function(k){kmeans(n2, k)$tot.withinss})
qplot(x = 1:k_max, y = twcss, geom = 'line')

# PCA
pca_n2 <- prcomp(n2)
summary(pca_n2)

##

biplot(prcomp(n1[2:13]), choices = 1:2, cex = c(0.5, 0.7), col = c("grey80", "deeppink2"))
autoplot(prcomp(n1[2:13]), data=n1, colour='Type', shape = FALSE, label = TRUE,  main = "Full data")

biplot(prcomp(n1[2:5]), choices = 1:2, cex = c(0.5, 0.7), col = c("grey80", "deeppink2"))
autoplot(prcomp(n1[2:5]), data=n1, colour='Type', shape = FALSE, label = TRUE,  main = "MgO + Al2O3 + SiO2 + K2O")

biplot(prcomp(n1[7:14]), choices = 1:2, cex = c(0.5, 0.7), col = c("grey80", "deeppink2"))
autoplot(prcomp(n1[7:14]), data=n1, colour='Type', shape = FALSE, label = TRUE,  main = "TiO2	+ MnO	+ Fe2O3 +	ZnO +	Rb2O + SrO + ZrO2 + BaO")

# HCA
# compute divisive hierarchical clustering
hc_n2 <- diana(n2)

# Divise coefficient; amount of clustering structure found
hc_n2$dc
## [1] 0.884993

# plot dendrogram
pltree(hc_n2, cex = 0.6, hang = -1, main = "Dendrogram of diana")

```


